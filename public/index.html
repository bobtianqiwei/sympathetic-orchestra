<!-- Sympathetic Orchestra -->
<!-- by Bob Tianqi Wei, Shm Garanganao Almeda, Ethan Tam, Dor Abrahamson and Bjoern Hartmann -->
<!-- UC Berkeley, 2024 -->

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <!-- keep the line below for OpenProcessing compatibility -->
  <script src="https://openprocessing.org/openprocessing_sketch.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.9.4/lib/p5.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/p5@1.9.4/lib/addons/p5.sound.min.js"></script>
  
  <link rel="stylesheet" type="text/css" href="style.css">
  <link href='https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600&display=swap' rel='stylesheet'>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
    }
    * {
      font-family: 'Manrope', sans-serif;
    }
    #loadingScreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(200, 200, 200, 0.95);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 10000;
    }
    #loadingProgressContainer {
      width: 300px;
      height: 8px;
      background-color: rgba(0, 0, 0, 0.1);
      border-radius: 4px;
      overflow: hidden;
    }
    #loadingProgressBar {
      height: 100%;
      background-color: #666;
      width: 0%;
      transition: width 0.3s ease;
      border-radius: 4px;
    }
    .control-button {
      font-family: 'Manrope', sans-serif;
      font-size: 12px;
      padding: 5px 8px;
      border-radius: 999px;
      background: white;
      color: black;
      border: none;
      cursor: pointer;
      margin-right: 10px;
      white-space: nowrap;
    }
    .control-button:last-child {
      margin-right: 0;
    }
    #title {
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 15px;
      font-family: 'Manrope', sans-serif;
      font-weight: 500;
      color: #333;
      z-index: 1000;
    }
    #buttonContainer {
      position: absolute;
      bottom: 10px;
      left: 10px;
      display: flex;
      align-items: center;
      z-index: 1000;
    }
    #videoContainer {
      display: none;
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 999;
    }
    #videoContainer.visible {
      display: block;
    }
    #slidersCard {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-radius: 10px;
      padding: 20px;
      display: none;
      z-index: 998;
      max-height: 80vh;
      overflow-y: auto;
      min-width: 400px;
    }
    #slidersCard.visible {
      display: block;
    }
    #slidersCard .slider-item {
      margin-bottom: 15px;
    }
    #slidersCard .slider-container {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    #slidersCard .slider-label {
      min-width: 120px;
      font-family: 'Manrope', sans-serif;
      font-weight: 500;
      font-size: 14px;
    }
    #slidersCard input[type="range"] {
      -webkit-appearance: none;
      appearance: none;
      background: transparent;
      cursor: pointer;
      width: 100%;
      height: 20px;
      margin: 0;
      flex: 1;
    }
    #slidersCard input[type="range"]::-webkit-slider-runnable-track {
      width: 100%;
      height: 4px;
      background: rgba(0, 0, 0, 0.1);
      border-radius: 2px;
    }
    #slidersCard input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      background: #666;
      height: 16px;
      width: 16px;
      border-radius: 50%;
      margin-top: -6px;
      cursor: pointer;
    }
    #slidersCard input[type="range"]::-moz-range-track {
      width: 100%;
      height: 4px;
      background: rgba(0, 0, 0, 0.1);
      border-radius: 2px;
      border: none;
    }
    #slidersCard input[type="range"]::-moz-range-thumb {
      background: #666;
      height: 16px;
      width: 16px;
      border-radius: 50%;
      border: none;
      cursor: pointer;
    }
    #slidersCard input[type="range"]:focus {
      outline: none;
    }
    #gestureInfoContainer {
      position: absolute;
      bottom: 10px;
      right: 10px;
      z-index: 1000;
      font-family: 'Manrope', sans-serif;
      font-size: 12px;
      color: #333;
      white-space: nowrap;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision/vision_bundle.js"
    crossorigin="anonymous"></script>
  
</head>

<body style="background-color: #C8C8C8; font-family: 'Manrope', sans-serif;">
  <!-- Loading Screen -->
  <div id="loadingScreen">
    <div id="loadingProgressContainer">
      <div id="loadingProgressBar"></div>
    </div>
  </div>
  
  <!-- Title -->
  <div id="title">Sympathetic Orchestra</div>
  
  <!-- Button Container (Bottom Left) -->
  <div id="buttonContainer">
    <button id="enableCameraButton" class="control-button">Enable Camera</button>
    <button id="cameraPreviewButton" class="control-button">Camera Preview</button>
    <button id="showSlidersButton" class="control-button">Show Sliders</button>
    <button id="playPauseButton" class="control-button">Play</button>
  </div>
  
  <!-- interface: -->
  <canvas id="output_canvas" style="display:none;"></canvas>
  <script src="mySketch.js"></script>
  
  <!-- Video Container (Top Right, hidden by default) -->
  <div id="videoContainer">
    <video id="webcam" style="width: 200px; border-radius: 10px; border: 3px solid white; transform: scaleX(-1);" autoplay playsinline></video>
  </div>
  
  <!-- Sliders Card (Center, hidden by default) -->
  <div id="slidersCard">
    <div id="slidersContent"></div>
  </div>
  
  <!-- Gesture Info Container (Bottom Right) -->
  <div id="gestureInfoContainer">
    <span id="gestureDisplayText">No hand detected</span>
  </div>
  
  <!-- computer vision code: -->
  <script type="module" src="recognize_hands.js"></script>
  
  <!-- Update gesture display -->
  <script>
    function formatGestureName(gestureName) {
      if (!gestureName || gestureName === '') {
        return null;
      }
      
      // Map gesture names to display names
      const gestureMap = {
        'Open_Palm': 'expression',
        'Pointing_Up': 'select',
        'None': 'play',
        'Closed_Fist': 'mute'
      };
      
      return gestureMap[gestureName] || gestureName;
    }
    
    function updateGestureDisplay() {
      const displayElement = document.getElementById('gestureDisplayText');
      if (!displayElement) return;
      
      if (window.sharedData && window.sharedData.leftGestureData && window.sharedData.rightGestureData) {
        const leftGesture = formatGestureName(window.sharedData.leftGestureData.gestureName);
        const rightGesture = formatGestureName(window.sharedData.rightGestureData.gestureName);
        
        if (!leftGesture && !rightGesture) {
          displayElement.textContent = 'No hand detected';
        } else {
          const leftText = leftGesture ? `Left: ${leftGesture}` : '';
          const rightText = rightGesture ? `Right: ${rightGesture}` : '';
          
          if (leftText && rightText) {
            displayElement.textContent = `${leftText} | ${rightText}`;
          } else if (leftText) {
            displayElement.textContent = leftText;
          } else if (rightText) {
            displayElement.textContent = rightText;
          } else {
            displayElement.textContent = 'No hand detected';
          }
        }
      } else {
        displayElement.textContent = 'No hand detected';
      }
      requestAnimationFrame(updateGestureDisplay);
    }
    
    // Start updating when page loads
    window.addEventListener('load', () => {
      // Wait a bit for sharedData to be initialized
      setTimeout(() => {
        updateGestureDisplay();
      }, 100);
    });
  </script>
  
</body>

</html>